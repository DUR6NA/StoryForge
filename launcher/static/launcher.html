<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoryForge Launcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            /* Default theme variables (will be overridden by active theme) */
            --color-primary: #6366f1;
            --color-secondary: #ec4899;
            --color-accent: #8b5cf6;
            --color-background: #020617;
            --color-surface: #1e293b;
            --color-surface-alt: #0f172a;
            --color-border: #374151;
            --color-text: #f3f4f6;
            --color-text-muted: #9ca3af;
            --color-text-dim: #6b7280;
            --color-success: #22c55e;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-info: #3b82f6;

            --btn-primary-bg: #6366f1;
            --btn-primary-text: #ffffff;
            --btn-primary-hover: #4f46e5;
            --btn-secondary-bg: transparent;
            --btn-secondary-text: #9ca3af;
            --btn-secondary-border: #374151;
            --btn-secondary-hover-bg: #1f2937;

            --sidebar-bg: #1e293b;
            --sidebar-item-active-bg: rgba(99, 102, 241, 0.2);
            --sidebar-item-text: #9ca3af;
            --sidebar-item-text-active: #6366f1;

            --card-bg: #1e293b;
            --card-border: rgba(55, 65, 81, 0.5);
            --card-hover-border: rgba(99, 102, 241, 0.5);

            --input-bg: #0f172a;
            --input-border: #374151;
            --input-focus-border: #6366f1;

            --scrollbar-track: #1e293b;
            --scrollbar-thumb: #475569;
            --scrollbar-thumb-hover: #64748b;

            --font-primary: 'Inter', system-ui, sans-serif;
        }

        * {
            font-family: var(--font-primary);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--scrollbar-thumb-hover);
        }

        [x-cloak] {
            display: none !important;
        }

        /* Theme background styles */
        .theme-background {
            background-color: var(--color-background);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .theme-background-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }

        /* Video background */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        /* Glassmorphism effects */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* Smooth transitions */
        .theme-transition {
            transition: all 0.3s ease-in-out;
        }

        /* Button animations */
        .btn-primary {
            background: var(--btn-primary-bg);
            color: var(--btn-primary-text);
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background: var(--btn-primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--btn-secondary-bg);
            color: var(--btn-secondary-text);
            border: 1px solid var(--btn-secondary-border);
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: var(--btn-secondary-hover-bg);
        }

        /* Card hover effects */
        .theme-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            transition: all 0.3s ease;
        }

        .theme-card:hover {
            border-color: var(--card-hover-border);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        /* Color picker styling */
        input[type="color"] {
            appearance: none;
            -webkit-appearance: none;
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch {
            border: 2px solid var(--color-border);
            border-radius: 6px;
        }

        /* File input styling */
        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        /* Theme preview card */
        .theme-preview-card {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .theme-preview-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.8) 100%);
            z-index: 1;
        }

        .theme-preview-card:hover {
            transform: scale(1.02);
        }

        .theme-preview-card.active {
            outline: 3px solid var(--color-primary);
            outline-offset: 2px;
        }

        /* Modal overlay */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
        }

        /* Range slider styling */
        input[type="range"] {
            appearance: none;
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--color-border);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px var(--color-primary);
        }

        /* Animated gradient border */
        .gradient-border {
            position: relative;
        }

        .gradient-border::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary), var(--color-accent));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: gradient-rotate 3s linear infinite;
        }

        @keyframes gradient-rotate {
            0% {
                filter: hue-rotate(0deg);
            }

            100% {
                filter: hue-rotate(360deg);
            }
        }

        /* Tab indicator */
        .tab-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            border-radius: 3px;
            transition: all 0.3s ease;
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: 'var(--color-primary)',
                        secondary: 'var(--color-secondary)',
                        accent: 'var(--color-accent)',
                        dark: 'var(--color-background)',
                        darker: 'var(--color-background)',
                        surface: 'var(--color-surface)',
                        'surface-alt': 'var(--color-surface-alt)',
                    }
                }
            }
        }
    </script>
</head>

<body class="theme-background text-gray-100 font-sans h-screen flex overflow-hidden select-none" x-data="launcher()"
    x-init="init()" :style="backgroundStyle">

    <!-- Video Background (if theme uses video) -->
    <template x-if="activeThemeData?.background?.type === 'video'">
        <video class="video-background" autoplay loop muted playsinline
            :src="getThemeAssetUrl(activeThemeData.background.value)"></video>
    </template>

    <!-- Background Overlay -->
    <div x-show="activeThemeData?.background?.overlay" class="fixed inset-0 pointer-events-none z-0"
        :style="{ backgroundColor: activeThemeData?.background?.overlay }"></div>

    <!-- Audio Elements for Theme Sounds -->
    <audio x-ref="bgMusic" loop :src="currentBgMusic" x-show="false"></audio>
    <audio x-ref="clickSound" :src="currentClickSound" x-show="false"></audio>
    <audio x-ref="hoverSound" :src="currentHoverSound" x-show="false"></audio>

    <!-- Main Container -->
    <div class="flex w-full h-full relative z-10">
        <!-- Sidebar -->
        <aside class="w-64 glass flex flex-col border-r theme-transition"
            :style="{ borderColor: 'var(--color-border)', backgroundColor: sidebarBg }">
            <div class="p-6 flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-lg"
                    :style="{ background: `linear-gradient(135deg, var(--color-primary), var(--color-secondary))` }">
                    S
                </div>
                <h1 class="text-xl font-bold tracking-wide" :style="{ color: 'var(--color-text)' }">StoryForge</h1>
            </div>

            <nav class="flex-1 px-4 space-y-2">
                <template x-for="item in menuItems" :key="item.id">
                    <button @click="setActiveTab(item.id)" @mouseenter="playHoverSound()"
                        :class="activeTab === item.id ? 'border-l-4' : 'border-l-4 border-transparent'" :style="activeTab === item.id ? 
                            { backgroundColor: 'var(--sidebar-item-active-bg)', color: 'var(--sidebar-item-text-active)', borderColor: 'var(--color-primary)' } : 
                            { color: 'var(--sidebar-item-text)' }"
                        class="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all text-left group hover:bg-white/5">
                        <span x-html="item.icon"></span>
                        <span x-text="item.label" class="font-medium"></span>
                    </button>
                </template>
            </nav>

            <div class="p-4 border-t" :style="{ borderColor: 'var(--color-border)' }">
                <div class="flex items-center gap-3 text-sm" :style="{ color: 'var(--color-text-muted)' }">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span>Online (Localhost)</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-w-0">
            <!-- Top Bar -->
            <header class="h-16 glass border-b flex items-center justify-between px-8 theme-transition"
                :style="{ borderColor: 'var(--color-border)' }">
                <h2 class="text-lg font-semibold" :style="{ color: 'var(--color-text)' }" x-text="currentTabLabel"></h2>

                <div class="flex items-center gap-4">
                    <div class="relative">
                        <input type="text" placeholder="Search library..."
                            class="rounded-full px-4 py-1.5 text-sm focus:outline-none w-64 transition-all" :style="{ 
                                backgroundColor: 'var(--input-bg)', 
                                borderColor: 'var(--input-border)',
                                color: 'var(--color-text)'
                            }" style="border-width: 1px;">
                        <svg class="w-4 h-4 absolute right-3 top-2" :style="{ color: 'var(--color-text-dim)' }"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <button class="p-2 transition-colors hover:text-white"
                        :style="{ color: 'var(--color-text-muted)' }">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                            </path>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-8">

                <!-- Library View -->
                <div x-show="activeTab === 'library'" x-transition.opacity>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <!-- Game Card -->
                        <template x-for="game in games" :key="game.id">
                            <div class="group theme-card rounded-xl overflow-hidden shadow-lg">
                                <div class="h-40 relative overflow-hidden"
                                    :style="{ backgroundColor: 'var(--color-surface-alt)' }">
                                    <template x-if="game.thumbnail">
                                        <img :src="'/library/' + game.id + '/' + game.thumbnail"
                                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                    </template>
                                    <template x-if="!game.thumbnail">
                                        <div class="w-full h-full flex items-center justify-center"
                                            :style="{ background: `linear-gradient(135deg, var(--color-surface), var(--color-surface-alt))` }">
                                            <span class="text-4xl">ðŸŽ²</span>
                                        </div>
                                    </template>
                                    <div
                                        class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100">
                                        <button @click="playGame(game.id)" @mouseenter="playHoverSound()"
                                            class="btn-primary px-6 py-2 rounded-full font-bold shadow-lg transform scale-90 group-hover:scale-100 transition-all flex items-center gap-2">
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                            PLAY
                                        </button>
                                    </div>
                                </div>
                                <div class="p-4">
                                    <h3 class="font-bold text-lg truncate" :style="{ color: 'var(--color-text)' }"
                                        x-text="game.title"></h3>
                                    <p class="text-sm truncate" :style="{ color: 'var(--color-text-muted)' }"
                                        x-text="'by ' + game.author"></p>
                                    <div class="mt-3 flex items-center justify-between text-xs"
                                        :style="{ color: 'var(--color-text-dim)' }">
                                        <span x-text="'v' + game.version"></span>
                                        <span class="px-2 py-0.5 rounded"
                                            :style="{ backgroundColor: 'var(--color-surface-alt)', color: 'var(--color-text-muted)' }">RPG</span>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Add New Placeholder -->
                        <div @click="activeTab = 'create'"
                            class="border-2 border-dashed rounded-xl flex flex-col items-center justify-center h-[280px] cursor-pointer transition-all group"
                            :style="{ 
                                backgroundColor: 'rgba(30, 41, 59, 0.3)', 
                                borderColor: 'var(--color-border)',
                                color: 'var(--color-text-dim)'
                            }"
                            @mouseenter="$el.style.borderColor = 'var(--color-primary)'; $el.style.color = 'var(--color-primary)'"
                            @mouseleave="$el.style.borderColor = 'var(--color-border)'; $el.style.color = 'var(--color-text-dim)'">
                            <svg class="w-12 h-12 mb-2 group-hover:scale-110 transition-transform" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4">
                                </path>
                            </svg>
                            <span class="font-medium">Create New Game</span>
                        </div>
                    </div>
                </div>

                <!-- Browse View -->
                <div x-show="activeTab === 'browse'" class="text-center py-20">
                    <h3 class="text-2xl font-bold" :style="{ color: 'var(--color-text-dim)' }">Local Browser</h3>
                    <p class="mt-2" :style="{ color: 'var(--color-text-dim)' }">Scan folders for .toml games...</p>
                </div>

                <!-- Create View -->
                <div x-show="activeTab === 'create'" class="text-center py-20">
                    <h3 class="text-2xl font-bold" :style="{ color: 'var(--color-text-dim)' }">StoryForge Editor</h3>
                    <p class="mt-2" :style="{ color: 'var(--color-text-dim)' }">Coming soon...</p>
                </div>

                <!-- Settings View -->
                <div x-show="activeTab === 'settings'" class="max-w-2xl mx-auto">
                    <h3 class="text-2xl font-bold mb-6" :style="{ color: 'var(--color-text)' }">Settings</h3>

                    <div class="glass rounded-xl p-6 space-y-6" :style="{ borderColor: 'var(--color-border)' }"
                        style="border-width: 1px;">
                        <!-- Themes Button -->
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium" :style="{ color: 'var(--color-text)' }">Themes</h4>
                                <p class="text-sm" :style="{ color: 'var(--color-text-muted)' }">Customize the launcher
                                    appearance</p>
                            </div>
                            <button @click="activeTab = 'themes'" @mouseenter="playHoverSound()"
                                class="btn-primary px-6 py-2 rounded-lg font-medium flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01">
                                    </path>
                                </svg>
                                Open Themes
                            </button>
                        </div>

                        <div class="border-t" :style="{ borderColor: 'var(--color-border)' }"></div>

                        <!-- Sound Settings -->
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium" :style="{ color: 'var(--color-text)' }">Enable Sounds</h4>
                                <p class="text-sm" :style="{ color: 'var(--color-text-muted)' }">Play UI sounds and
                                    theme music</p>
                            </div>
                            <button
                                @click="themeSettings.enableSounds = !themeSettings.enableSounds; saveThemeSettings()"
                                class="w-12 h-6 rounded-full relative cursor-pointer transition-colors"
                                :style="{ backgroundColor: themeSettings.enableSounds ? 'var(--color-primary)' : 'var(--color-border)' }">
                                <div class="absolute top-1 w-4 h-4 bg-white rounded-full shadow transition-all"
                                    :style="{ left: themeSettings.enableSounds ? '1.625rem' : '0.25rem' }"></div>
                            </button>
                        </div>

                        <!-- Volume Slider -->
                        <div x-show="themeSettings.enableSounds" class="space-y-2">
                            <div class="flex items-center justify-between">
                                <h4 class="font-medium" :style="{ color: 'var(--color-text)' }">Master Volume</h4>
                                <span class="text-sm" :style="{ color: 'var(--color-text-muted)' }"
                                    x-text="Math.round(themeSettings.masterVolume * 100) + '%'"></span>
                            </div>
                            <input type="range" min="0" max="1" step="0.05" x-model="themeSettings.masterVolume"
                                @change="saveThemeSettings()">
                        </div>

                        <div class="border-t" :style="{ borderColor: 'var(--color-border)' }"></div>

                        <!-- GPU Acceleration / Renderer Selection -->
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium flex items-center gap-2"
                                        :style="{ color: 'var(--color-text)' }">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                                            </path>
                                        </svg>
                                        GPU Acceleration
                                    </h4>
                                    <p class="text-sm mt-1" :style="{ color: 'var(--color-text-muted)' }">Choose your
                                        rendering engine for optimal performance</p>
                                </div>
                                <button @click="activeTab = 'gpu'" @mouseenter="playHoverSound()"
                                    class="btn-primary px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                                        </path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    Configure
                                </button>
                            </div>

                            <!-- Current Renderer Status -->
                            <div class="p-3 rounded-lg" :style="{ backgroundColor: 'var(--color-surface-alt)' }">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                                            :style="{ background: appSettings.renderer === 'edgechromium' ? 'linear-gradient(135deg, #0078D4, #0050A0)' : appSettings.renderer === 'cef' ? 'linear-gradient(135deg, #5586A4, #2D4A5C)' : 'linear-gradient(135deg, #6B7280, #374151)' }">
                                            <template x-if="appSettings.renderer === 'edgechromium'">
                                                <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M3 12h4l3-9 4 18 3-9h4" />
                                                </svg>
                                            </template>
                                            <template x-if="appSettings.renderer === 'cef'">
                                                <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                                                </svg>
                                            </template>
                                            <template x-if="appSettings.renderer === 'mshtml'">
                                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                                                    </path>
                                                </svg>
                                            </template>
                                        </div>
                                        <div>
                                            <p class="font-medium" :style="{ color: 'var(--color-text)' }"
                                                x-text="getRendererDisplayName(appSettings.renderer)"></p>
                                            <p class="text-xs" :style="{ color: 'var(--color-text-dim)' }"
                                                x-text="getRendererApi(appSettings.renderer)"></p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2"
                                        :style="{ color: appSettings.renderer === 'mshtml' ? '#F59E0B' : '#10B981' }">
                                        <div class="w-2 h-2 rounded-full"
                                            :style="{ backgroundColor: appSettings.renderer === 'mshtml' ? '#F59E0B' : '#10B981' }">
                                        </div>
                                        <span class="text-xs font-medium"
                                            x-text="appSettings.renderer === 'mshtml' ? 'Software' : 'GPU Accelerated'"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GPU Settings View -->
                <div x-show="activeTab === 'gpu'" x-transition.opacity class="space-y-8">
                    <!-- Header with back button -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <button @click="activeTab = 'settings'"
                                class="p-2 rounded-lg transition-colors hover:bg-white/10"
                                :style="{ color: 'var(--color-text-muted)' }">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                </svg>
                            </button>
                            <div>
                                <h3 class="text-2xl font-bold" :style="{ color: 'var(--color-text)' }">GPU Acceleration
                                </h3>
                                <p class="text-sm" :style="{ color: 'var(--color-text-muted)' }">Configure rendering
                                    engine for optimal performance</p>
                            </div>
                        </div>
                    </div>

                    <!-- GPU Selection Card -->
                    <div class="glass rounded-xl p-6" :style="{ borderColor: 'var(--color-border)' }"
                        style="border-width: 1px;">
                        <h4 class="font-bold text-lg mb-4 flex items-center gap-2"
                            :style="{ color: 'var(--color-text)' }">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                                </path>
                            </svg>
                            Select Graphics Card
                            <span x-show="gpuInfo.multi_gpu" class="px-2 py-0.5 text-xs font-medium rounded"
                                style="background: #3B82F6; color: white;">
                                Multiple GPUs Detected
                            </span>
                        </h4>
                        <p class="text-sm mb-4" :style="{ color: 'var(--color-text-muted)' }">
                            Choose which graphics card to use for rendering. Discrete GPUs (NVIDIA/AMD) offer better
                            performance.
                        </p>

                        <!-- GPU List -->
                        <div class="space-y-3">
                            <template x-for="gpu in gpuInfo.gpus || []" :key="gpu.id">
                                <div @click="selectGpu(gpu.id)"
                                    class="p-4 rounded-xl cursor-pointer transition-all border-2 group"
                                    :class="appSettings.selected_gpu === gpu.id ? 'ring-2 ring-offset-2 ring-offset-transparent' : ''"
                                    :style="{ 
                                        borderColor: appSettings.selected_gpu === gpu.id ? 'var(--color-primary)' : 'var(--color-border)',
                                        backgroundColor: appSettings.selected_gpu === gpu.id ? 'rgba(99, 102, 241, 0.1)' : 'var(--color-surface-alt)',
                                        ringColor: appSettings.selected_gpu === gpu.id ? 'var(--color-primary)' : 'transparent'
                                    }">
                                    <div class="flex items-center gap-4">
                                        <!-- GPU Icon -->
                                        <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                                            :style="{ background: getGpuGradient(gpu) }">
                                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                                                </path>
                                            </svg>
                                        </div>

                                        <!-- GPU Info -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                                <h5 class="font-bold truncate" :style="{ color: 'var(--color-text)' }"
                                                    x-text="gpu.name"></h5>
                                                <span x-show="gpu.is_discrete"
                                                    class="px-2 py-0.5 text-xs font-bold rounded flex-shrink-0"
                                                    style="background: linear-gradient(135deg, #10B981, #059669); color: white;">
                                                    DISCRETE
                                                </span>
                                                <span x-show="!gpu.is_discrete"
                                                    class="px-2 py-0.5 text-xs font-medium rounded flex-shrink-0"
                                                    style="background: #6B7280; color: white;">
                                                    INTEGRATED
                                                </span>
                                                <span x-show="gpu.is_recommended"
                                                    class="px-2 py-0.5 text-xs font-medium rounded flex-shrink-0"
                                                    style="background: #F59E0B; color: white;">
                                                    RECOMMENDED
                                                </span>
                                            </div>
                                            <div class="flex items-center gap-4 text-xs flex-wrap"
                                                :style="{ color: 'var(--color-text-dim)' }">
                                                <span class="flex items-center gap-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                                                        </path>
                                                    </svg>
                                                    <span x-text="gpu.adapter_ram || 'Unknown'"></span> VRAM
                                                </span>
                                                <span class="flex items-center gap-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                                                        </path>
                                                    </svg>
                                                    Driver: <span x-text="gpu.driver_version || 'Unknown'"></span>
                                                </span>
                                                <span class="flex items-center gap-1" x-show="gpu.vendor">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                                                        </path>
                                                    </svg>
                                                    <span x-text="gpu.vendor"></span>
                                                </span>
                                            </div>
                                        </div>

                                        <!-- Selection Indicator -->
                                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0"
                                            :style="{ borderColor: appSettings.selected_gpu === gpu.id ? 'var(--color-primary)' : 'var(--color-border)' }">
                                            <div x-show="appSettings.selected_gpu === gpu.id"
                                                class="w-3 h-3 rounded-full"
                                                :style="{ backgroundColor: 'var(--color-primary)' }"></div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- No GPUs Message -->
                            <div x-show="!gpuInfo.gpus || gpuInfo.gpus.length === 0" class="p-4 rounded-lg text-center"
                                :style="{ backgroundColor: 'var(--color-surface-alt)' }">
                                <p :style="{ color: 'var(--color-text-muted)' }">Detecting graphics cards...</p>
                            </div>
                        </div>

                        <!-- Auto-select Option -->
                        <div class="mt-4 flex items-center gap-3 p-3 rounded-lg"
                            :style="{ backgroundColor: 'var(--color-surface-alt)' }">
                            <button
                                @click="appSettings.prefer_discrete_gpu = !appSettings.prefer_discrete_gpu; saveAppSettings()"
                                class="w-10 h-5 rounded-full relative cursor-pointer transition-colors flex-shrink-0"
                                :style="{ backgroundColor: appSettings.prefer_discrete_gpu ? 'var(--color-primary)' : 'var(--color-border)' }">
                                <div class="absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all"
                                    :style="{ left: appSettings.prefer_discrete_gpu ? '1.375rem' : '0.125rem' }"></div>
                            </button>
                            <div>
                                <p class="font-medium text-sm" :style="{ color: 'var(--color-text)' }">Auto-select
                                    discrete GPU</p>
                                <p class="text-xs" :style="{ color: 'var(--color-text-dim)' }">Automatically use the
                                    most powerful GPU when available</p>
                            </div>
                        </div>
                    </div>


                    <!-- Renderer Selection -->
                    <div class="glass rounded-xl p-6" :style="{ borderColor: 'var(--color-border)' }"
                        style="border-width: 1px;">
                        <h4 class="font-bold text-lg mb-4" :style="{ color: 'var(--color-text)' }">Choose Renderer</h4>
                        <p class="text-sm mb-6" :style="{ color: 'var(--color-text-muted)' }">Select the rendering
                            engine that works best with your system. Changes require a restart.</p>

                        <div class="space-y-3">
                            <!-- DirectX / Edge Chromium -->
                            <div @click="selectRenderer('edgechromium')"
                                class="p-4 rounded-xl cursor-pointer transition-all border-2 group"
                                :class="appSettings.renderer === 'edgechromium' ? 'ring-2 ring-offset-2 ring-offset-transparent' : ''"
                                :style="{ 
                                    borderColor: appSettings.renderer === 'edgechromium' ? 'var(--color-primary)' : 'var(--color-border)',
                                    backgroundColor: appSettings.renderer === 'edgechromium' ? 'rgba(var(--color-primary-rgb), 0.1)' : 'var(--color-surface-alt)',
                                    ringColor: appSettings.renderer === 'edgechromium' ? 'var(--color-primary)' : 'transparent'
                                }">
                                <div class="flex items-start gap-4">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                                        style="background: linear-gradient(135deg, #0078D4, #0050A0);">
                                        <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <h5 class="font-bold" :style="{ color: 'var(--color-text)' }">Edge Chromium
                                                (DirectX)</h5>
                                            <span class="px-2 py-0.5 text-xs font-bold rounded"
                                                style="background: linear-gradient(135deg, #10B981, #059669); color: white;">RECOMMENDED</span>
                                        </div>
                                        <p class="text-sm mb-2" :style="{ color: 'var(--color-text-muted)' }">
                                            Modern GPU-accelerated renderer using Microsoft Edge WebView2. Leverages
                                            DirectX 11/12 via ANGLE for maximum performance on Windows.
                                        </p>
                                        <div class="flex items-center gap-4 text-xs"
                                            :style="{ color: 'var(--color-text-dim)' }">
                                            <span class="flex items-center gap-1">
                                                <svg class="w-4 h-4 text-green-500" fill="currentColor"
                                                    viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                GPU Accelerated
                                            </span>
                                            <span>Direct3D 11/12</span>
                                            <span>Requires: Edge WebView2 Runtime</span>
                                        </div>
                                    </div>
                                    <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0"
                                        :style="{ borderColor: appSettings.renderer === 'edgechromium' ? 'var(--color-primary)' : 'var(--color-border)' }">
                                        <div x-show="appSettings.renderer === 'edgechromium'"
                                            class="w-3 h-3 rounded-full"
                                            :style="{ backgroundColor: 'var(--color-primary)' }"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- OpenGL / CEF -->
                            <div @click="selectRenderer('cef')"
                                class="p-4 rounded-xl cursor-pointer transition-all border-2 group"
                                :class="appSettings.renderer === 'cef' ? 'ring-2 ring-offset-2 ring-offset-transparent' : ''"
                                :style="{ 
                                    borderColor: appSettings.renderer === 'cef' ? 'var(--color-primary)' : 'var(--color-border)',
                                    backgroundColor: appSettings.renderer === 'cef' ? 'rgba(var(--color-primary-rgb), 0.1)' : 'var(--color-surface-alt)',
                                    ringColor: appSettings.renderer === 'cef' ? 'var(--color-primary)' : 'transparent'
                                }">
                                <div class="flex items-start gap-4">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                                        style="background: linear-gradient(135deg, #5586A4, #2D4A5C);">
                                        <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <h5 class="font-bold" :style="{ color: 'var(--color-text)' }">CEF (OpenGL)
                                            </h5>
                                        </div>
                                        <p class="text-sm mb-2" :style="{ color: 'var(--color-text-muted)' }">
                                            Chromium Embedded Framework with OpenGL backend. Excellent cross-platform
                                            compatibility and GPU acceleration. Requires additional package.
                                        </p>
                                        <div class="flex items-center gap-4 text-xs"
                                            :style="{ color: 'var(--color-text-dim)' }">
                                            <span class="flex items-center gap-1">
                                                <svg class="w-4 h-4 text-green-500" fill="currentColor"
                                                    viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                GPU Accelerated
                                            </span>
                                            <span>OpenGL 3.3+</span>
                                            <span>Requires: cefpython3 package</span>
                                        </div>
                                    </div>
                                    <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0"
                                        :style="{ borderColor: appSettings.renderer === 'cef' ? 'var(--color-primary)' : 'var(--color-border)' }">
                                        <div x-show="appSettings.renderer === 'cef'" class="w-3 h-3 rounded-full"
                                            :style="{ backgroundColor: 'var(--color-primary)' }"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Software / MSHTML -->
                            <div @click="selectRenderer('mshtml')"
                                class="p-4 rounded-xl cursor-pointer transition-all border-2 group"
                                :class="appSettings.renderer === 'mshtml' ? 'ring-2 ring-offset-2 ring-offset-transparent' : ''"
                                :style="{ 
                                    borderColor: appSettings.renderer === 'mshtml' ? 'var(--color-primary)' : 'var(--color-border)',
                                    backgroundColor: appSettings.renderer === 'mshtml' ? 'rgba(var(--color-primary-rgb), 0.1)' : 'var(--color-surface-alt)',
                                    ringColor: appSettings.renderer === 'mshtml' ? 'var(--color-primary)' : 'transparent'
                                }">
                                <div class="flex items-start gap-4">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                                        style="background: linear-gradient(135deg, #6B7280, #374151);">
                                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <h5 class="font-bold" :style="{ color: 'var(--color-text)' }">Legacy
                                                (Software Rendering)</h5>
                                            <span class="px-2 py-0.5 text-xs font-medium rounded"
                                                style="background: #F59E0B; color: white;">FALLBACK</span>
                                        </div>
                                        <p class="text-sm mb-2" :style="{ color: 'var(--color-text-muted)' }">
                                            Legacy IE-based renderer with software rendering. No GPU acceleration. Use
                                            only if GPU renderers cause issues on your system.
                                        </p>
                                        <div class="flex items-center gap-4 text-xs"
                                            :style="{ color: 'var(--color-text-dim)' }">
                                            <span class="flex items-center gap-1">
                                                <svg class="w-4 h-4 text-yellow-500" fill="currentColor"
                                                    viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                CPU Only
                                            </span>
                                            <span>Software (GDI)</span>
                                            <span>Always available</span>
                                        </div>
                                    </div>
                                    <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0"
                                        :style="{ borderColor: appSettings.renderer === 'mshtml' ? 'var(--color-primary)' : 'var(--color-border)' }">
                                        <div x-show="appSettings.renderer === 'mshtml'" class="w-3 h-3 rounded-full"
                                            :style="{ backgroundColor: 'var(--color-primary)' }"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Restart Notice -->
                    <div x-show="pendingRendererChange" x-transition
                        class="glass rounded-xl p-4 flex items-center justify-between"
                        style="border: 1px solid #F59E0B; background: rgba(245, 158, 11, 0.1);">
                        <div class="flex items-center gap-3">
                            <svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <div>
                                <p class="font-medium" style="color: #F59E0B;">Restart Required</p>
                                <p class="text-sm" :style="{ color: 'var(--color-text-muted)' }">Close and reopen
                                    StoryForge to apply the new renderer.</p>
                            </div>
                        </div>
                        <button @click="pendingRendererChange = false" class="px-4 py-2 rounded-lg font-medium text-sm"
                            style="background: #F59E0B; color: white;">
                            Dismiss
                        </button>
                    </div>

                    <!-- Performance Tips -->
                    <div class="glass rounded-xl p-6" :style="{ borderColor: 'var(--color-border)' }"
                        style="border-width: 1px;">
                        <h4 class="font-bold text-lg mb-4 flex items-center gap-2"
                            :style="{ color: 'var(--color-text)' }">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                                </path>
                            </svg>
                            Performance Tips
                        </h4>
                        <div class="grid md:grid-cols-3 gap-4 text-sm">
                            <div class="p-3 rounded-lg" :style="{ backgroundColor: 'var(--color-surface-alt)' }">
                                <h5 class="font-semibold mb-1" :style="{ color: 'var(--color-text)' }">ðŸ’Ž Best Quality
                                </h5>
                                <p :style="{ color: 'var(--color-text-muted)' }">Use Edge Chromium (DirectX) for the
                                    smoothest animations and best visual quality.</p>
                            </div>
                            <div class="p-3 rounded-lg" :style="{ backgroundColor: 'var(--color-surface-alt)' }">
                                <h5 class="font-semibold mb-1" :style="{ color: 'var(--color-text)' }">ðŸ”„ Compatibility
                                </h5>
                                <p :style="{ color: 'var(--color-text-muted)' }">If you experience issues, try CEF
                                    (OpenGL) as an alternative GPU renderer.</p>
                            </div>
                            <div class="p-3 rounded-lg" :style="{ backgroundColor: 'var(--color-surface-alt)' }">
                                <h5 class="font-semibold mb-1" :style="{ color: 'var(--color-text)' }">ðŸ›¡ï¸
                                    Troubleshooting</h5>
                                <p :style="{ color: 'var(--color-text-muted)' }">Legacy mode disables GPU acceleration
                                    entirely if rendering problems persist.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Themes View -->
                <div x-show="activeTab === 'themes'" x-transition.opacity class="space-y-8">
                    <!-- Header with back button -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <button @click="activeTab = 'settings'"
                                class="p-2 rounded-lg transition-colors hover:bg-white/10"
                                :style="{ color: 'var(--color-text-muted)' }">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                </svg>
                            </button>
                            <div>
                                <h3 class="text-2xl font-bold" :style="{ color: 'var(--color-text)' }">Theme Gallery
                                </h3>
                                <p class="text-sm" :style="{ color: 'var(--color-text-muted)' }">Choose or create your
                                    perfect look</p>
                            </div>
                        </div>

                        <div class="flex items-center gap-3">
                            <!-- Download Template Button -->
                            <a href="/api/themes/template/download" download
                                class="btn-secondary px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Download Template
                            </a>

                            <!-- Upload Theme Button -->
                            <div class="file-upload">
                                <button class="btn-primary px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                    </svg>
                                    Upload Theme
                                </button>
                                <input type="file" accept=".zip" @change="uploadTheme($event)">
                            </div>
                        </div>
                    </div>

                    <!-- Theme Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="theme in themes" :key="theme.meta.id">
                            <div class="theme-card rounded-xl overflow-hidden cursor-pointer relative group"
                                :class="{ 'ring-2 ring-offset-2 ring-offset-transparent': themeSettings.activeTheme === theme.meta.id }"
                                :style="themeSettings.activeTheme === theme.meta.id ? { ringColor: 'var(--color-primary)' } : {}"
                                @click="activateTheme(theme.meta.id)">

                                <!-- Theme Preview -->
                                <div class="h-40 relative overflow-hidden">
                                    <template x-if="theme.meta.preview">
                                        <img :src="getThemePreviewUrl(theme)" class="w-full h-full object-cover">
                                    </template>
                                    <template x-if="!theme.meta.preview">
                                        <div class="w-full h-full flex items-center justify-center"
                                            :style="{ background: getThemeGradient(theme) }">
                                            <svg class="w-16 h-16 opacity-50" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                                    d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01">
                                                </path>
                                            </svg>
                                        </div>
                                    </template>

                                    <!-- Active Badge -->
                                    <div x-show="themeSettings.activeTheme === theme.meta.id"
                                        class="absolute top-3 right-3 px-3 py-1 rounded-full text-xs font-bold text-white"
                                        :style="{ backgroundColor: 'var(--color-primary)' }">
                                        ACTIVE
                                    </div>

                                    <!-- Built-in Badge -->
                                    <div x-show="theme.meta.isBuiltIn"
                                        class="absolute top-3 left-3 px-2 py-1 rounded text-xs font-medium bg-black/50 text-white">
                                        Built-in
                                    </div>

                                    <!-- Delete Button (for user themes only) -->
                                    <button x-show="!theme.meta.isBuiltIn" @click.stop="deleteTheme(theme.meta.id)"
                                        class="absolute top-3 right-3 p-2 rounded-lg bg-red-500/80 hover:bg-red-600 text-white opacity-0 group-hover:opacity-100 transition-opacity">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                            </path>
                                        </svg>
                                    </button>
                                </div>

                                <!-- Theme Info -->
                                <div class="p-4">
                                    <h4 class="font-bold text-lg" :style="{ color: 'var(--color-text)' }"
                                        x-text="theme.meta.name"></h4>
                                    <p class="text-sm" :style="{ color: 'var(--color-text-muted)' }"
                                        x-text="'by ' + theme.meta.author"></p>
                                    <p class="text-xs mt-2 line-clamp-2" :style="{ color: 'var(--color-text-dim)' }"
                                        x-text="theme.meta.description"></p>

                                    <!-- Color Swatches -->
                                    <div class="flex gap-1 mt-3">
                                        <template x-for="color in getThemeColors(theme)" :key="color">
                                            <div class="w-5 h-5 rounded-full border border-white/20"
                                                :style="{ backgroundColor: color }"></div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Theme Documentation -->
                    <div class="glass rounded-xl p-6 mt-8" :style="{ borderColor: 'var(--color-border)' }"
                        style="border-width: 1px;">
                        <h4 class="font-bold text-lg mb-4" :style="{ color: 'var(--color-text)' }">Creating Custom
                            Themes</h4>

                        <div class="grid md:grid-cols-2 gap-6 text-sm" :style="{ color: 'var(--color-text-muted)' }">
                            <div class="space-y-4">
                                <div>
                                    <h5 class="font-semibold mb-2" :style="{ color: 'var(--color-text)' }">ðŸ“ Theme
                                        Structure</h5>
                                    <pre class="p-3 rounded-lg text-xs overflow-x-auto"
                                        :style="{ backgroundColor: 'var(--color-surface-alt)' }">my-theme/
â”œâ”€â”€ theme.json      (required)
â”œâ”€â”€ preview.png     (optional)
â”œâ”€â”€ background.jpg  (optional)
â”œâ”€â”€ background.mp4  (optional)
â”œâ”€â”€ click.mp3       (optional)
â”œâ”€â”€ hover.mp3       (optional)
â””â”€â”€ ambient.mp3     (optional)</pre>
                                </div>

                                <div>
                                    <h5 class="font-semibold mb-2" :style="{ color: 'var(--color-text)' }">ðŸŽ¨ Background
                                        Types</h5>
                                    <ul class="list-disc list-inside space-y-1">
                                        <li><strong>solid</strong> - Single color (hex)</li>
                                        <li><strong>gradient</strong> - CSS gradient</li>
                                        <li><strong>image</strong> - JPG/PNG/WebP file</li>
                                        <li><strong>video</strong> - MP4/WebM file</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <h5 class="font-semibold mb-2" :style="{ color: 'var(--color-text)' }">ðŸ”Š Sound
                                        Options</h5>
                                    <ul class="list-disc list-inside space-y-1">
                                        <li><strong>buttonClick</strong> - Click feedback</li>
                                        <li><strong>buttonHover</strong> - Hover feedback</li>
                                        <li><strong>navigation</strong> - Tab changes</li>
                                        <li><strong>notification</strong> - Alerts</li>
                                        <li><strong>backgroundMusic</strong> - Ambient music</li>
                                    </ul>
                                </div>

                                <div>
                                    <h5 class="font-semibold mb-2" :style="{ color: 'var(--color-text)' }">âœ¨ Effects
                                    </h5>
                                    <ul class="list-disc list-inside space-y-1">
                                        <li><strong>blur</strong> - Enable backdrop blur</li>
                                        <li><strong>glassmorphism</strong> - Glass effect</li>
                                        <li><strong>animations</strong> - UI animations</li>
                                        <li><strong>shadows</strong> - Drop shadows</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Status Bar -->
            <footer class="h-8 border-t flex items-center justify-between px-4 text-xs theme-transition"
                :style="{ backgroundColor: 'var(--color-background)', borderColor: 'var(--color-border)', color: 'var(--color-text-dim)' }">
                <span>StoryForge v0.1.0-alpha</span>
                <span class="flex items-center gap-2">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                        </path>
                    </svg>
                    Drag & drop .zip or .storyforge games here to import
                </span>
            </footer>
        </main>
    </div>

    <!-- Upload Progress Modal -->
    <div x-show="uploadProgress.show" x-transition.opacity
        class="fixed inset-0 modal-overlay flex items-center justify-center z-50">
        <div class="glass rounded-xl p-6 w-80 text-center" :style="{ borderColor: 'var(--color-border)' }"
            style="border-width: 1px;">
            <div x-show="uploadProgress.loading" class="space-y-4">
                <div class="w-12 h-12 mx-auto border-4 border-t-transparent rounded-full animate-spin"
                    :style="{ borderColor: 'var(--color-primary)', borderTopColor: 'transparent' }"></div>
                <p :style="{ color: 'var(--color-text)' }">Uploading theme...</p>
            </div>
            <div x-show="!uploadProgress.loading" class="space-y-4">
                <div x-show="uploadProgress.success" class="text-green-500">
                    <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <p class="mt-2" :style="{ color: 'var(--color-text)' }" x-text="uploadProgress.message"></p>
                </div>
                <div x-show="!uploadProgress.success" class="text-red-500">
                    <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                    <p class="mt-2" :style="{ color: 'var(--color-text)' }" x-text="uploadProgress.message"></p>
                </div>
                <button @click="uploadProgress.show = false" class="btn-primary px-6 py-2 rounded-lg">Close</button>
            </div>
        </div>
    </div>

    <script>
        function launcher() {
            return {
                activeTab: 'library',
                games: [],
                themes: [],
                activeThemeData: null,
                themeSettings: {
                    activeTheme: 'dark',
                    enableSounds: true,
                    masterVolume: 0.5
                },
                uploadProgress: {
                    show: false,
                    loading: false,
                    success: false,
                    message: ''
                },
                // GPU/Renderer settings
                appSettings: {
                    renderer: 'edgechromium',
                    selected_gpu: 0,
                    enable_hardware_acceleration: true,
                    prefer_discrete_gpu: true,
                    vsync: true,
                    max_fps: 60
                },
                gpuInfo: {
                    platform: 'Windows',
                    gpu_name: 'Detecting...',
                    driver_version: 'Unknown',
                    available_renderers: ['edgechromium', 'cef', 'mshtml'],
                    recommended: 'edgechromium',
                    gpus: [],
                    multi_gpu: false,
                    has_discrete_gpu: false
                },
                pendingRendererChange: false,
                menuItems: [
                    { id: 'library', label: 'My Library', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>' },
                    { id: 'browse', label: 'Browse Local', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>' },
                    { id: 'create', label: 'Create New', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>' },
                    { id: 'settings', label: 'Settings', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>' },
                ],

                get currentTabLabel() {
                    if (this.activeTab === 'themes') return 'Themes';
                    if (this.activeTab === 'gpu') return 'GPU Acceleration';
                    return this.menuItems.find(i => i.id === this.activeTab)?.label || 'Unknown';
                },

                get backgroundStyle() {
                    if (!this.activeThemeData?.background) return {};

                    const bg = this.activeThemeData.background;

                    if (bg.type === 'solid') {
                        return { backgroundColor: bg.value };
                    } else if (bg.type === 'gradient') {
                        return { background: bg.value };
                    } else if (bg.type === 'image') {
                        return {
                            backgroundImage: `url(${this.getThemeAssetUrl(bg.value)})`,
                            backgroundSize: 'cover',
                            backgroundPosition: 'center'
                        };
                    }

                    return {};
                },

                get sidebarBg() {
                    if (this.activeThemeData?.sidebar?.background) {
                        return this.activeThemeData.sidebar.background;
                    }
                    return 'var(--sidebar-bg)';
                },

                get currentBgMusic() {
                    if (!this.themeSettings.enableSounds || !this.activeThemeData?.sounds?.backgroundMusic) {
                        return '';
                    }
                    return this.getThemeAssetUrl(this.activeThemeData.sounds.backgroundMusic);
                },

                get currentClickSound() {
                    if (!this.themeSettings.enableSounds || !this.activeThemeData?.sounds?.buttonClick) {
                        return '';
                    }
                    return this.getThemeAssetUrl(this.activeThemeData.sounds.buttonClick);
                },

                get currentHoverSound() {
                    if (!this.themeSettings.enableSounds || !this.activeThemeData?.sounds?.buttonHover) {
                        return '';
                    }
                    return this.getThemeAssetUrl(this.activeThemeData.sounds.buttonHover);
                },

                async init() {
                    await this.fetchThemeSettings();
                    await this.fetchActiveTheme();
                    await this.fetchGames();
                    await this.fetchThemes();
                    await this.fetchAppSettings();
                    await this.fetchGpuInfo();

                    // Start background music if enabled
                    this.$nextTick(() => {
                        if (this.currentBgMusic && this.$refs.bgMusic) {
                            this.$refs.bgMusic.volume = this.themeSettings.masterVolume * 0.3;
                            this.$refs.bgMusic.play().catch(() => { });
                        }
                    });
                },

                setActiveTab(tabId) {
                    this.playClickSound();
                    this.activeTab = tabId;
                },

                playClickSound() {
                    if (this.themeSettings.enableSounds && this.$refs.clickSound && this.currentClickSound) {
                        this.$refs.clickSound.volume = this.themeSettings.masterVolume;
                        this.$refs.clickSound.currentTime = 0;
                        this.$refs.clickSound.play().catch(() => { });
                    }
                },

                playHoverSound() {
                    if (this.themeSettings.enableSounds && this.$refs.hoverSound && this.currentHoverSound) {
                        this.$refs.hoverSound.volume = this.themeSettings.masterVolume * 0.3;
                        this.$refs.hoverSound.currentTime = 0;
                        this.$refs.hoverSound.play().catch(() => { });
                    }
                },

                async fetchGames() {
                    try {
                        const res = await fetch('/api/library');
                        this.games = await res.json();
                    } catch (e) {
                        console.error("Failed to load games", e);
                    }
                },

                async fetchThemes() {
                    try {
                        const res = await fetch('/api/themes/list');
                        this.themes = await res.json();
                    } catch (e) {
                        console.error("Failed to load themes", e);
                    }
                },

                async fetchThemeSettings() {
                    try {
                        const res = await fetch('/api/themes/settings/current');
                        this.themeSettings = await res.json();
                    } catch (e) {
                        console.error("Failed to load theme settings", e);
                    }
                },

                async fetchActiveTheme() {
                    try {
                        const res = await fetch('/api/themes/active');
                        this.activeThemeData = await res.json();
                        this.applyTheme(this.activeThemeData);
                    } catch (e) {
                        console.error("Failed to load active theme", e);
                    }
                },

                async saveThemeSettings() {
                    try {
                        await fetch('/api/themes/settings/update', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.themeSettings)
                        });

                        // Update music volume
                        if (this.$refs.bgMusic) {
                            this.$refs.bgMusic.volume = this.themeSettings.masterVolume * 0.3;
                            if (!this.themeSettings.enableSounds) {
                                this.$refs.bgMusic.pause();
                            } else if (this.currentBgMusic) {
                                this.$refs.bgMusic.play().catch(() => { });
                            }
                        }
                    } catch (e) {
                        console.error("Failed to save theme settings", e);
                    }
                },

                async activateTheme(themeId) {
                    try {
                        await fetch(`/api/themes/activate/${themeId}`, { method: 'POST' });
                        this.themeSettings.activeTheme = themeId;
                        await this.fetchActiveTheme();
                    } catch (e) {
                        console.error("Failed to activate theme", e);
                    }
                },

                async uploadTheme(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    this.uploadProgress = {
                        show: true,
                        loading: true,
                        success: false,
                        message: ''
                    };

                    try {
                        const formData = new FormData();
                        formData.append('file', file);

                        const res = await fetch('/api/themes/upload', {
                            method: 'POST',
                            body: formData
                        });

                        const result = await res.json();

                        if (res.ok) {
                            this.uploadProgress.success = true;
                            this.uploadProgress.message = `Theme "${result.name}" uploaded successfully!`;
                            await this.fetchThemes();
                        } else {
                            this.uploadProgress.success = false;
                            this.uploadProgress.message = result.detail || 'Upload failed';
                        }
                    } catch (e) {
                        this.uploadProgress.success = false;
                        this.uploadProgress.message = 'Upload failed: ' + e.message;
                    } finally {
                        this.uploadProgress.loading = false;
                        event.target.value = '';
                    }
                },

                async deleteTheme(themeId) {
                    if (!confirm('Are you sure you want to delete this theme?')) return;

                    try {
                        const res = await fetch(`/api/themes/${themeId}`, { method: 'DELETE' });
                        if (res.ok) {
                            await this.fetchThemes();
                            if (this.themeSettings.activeTheme === themeId) {
                                await this.activateTheme('dark');
                            }
                        }
                    } catch (e) {
                        console.error("Failed to delete theme", e);
                    }
                },

                applyTheme(theme) {
                    if (!theme) return;

                    const root = document.documentElement;
                    const colors = theme.colors || {};
                    const buttons = theme.buttons || {};
                    const sidebar = theme.sidebar || {};
                    const cards = theme.cards || {};
                    const inputs = theme.inputs || {};
                    const scrollbar = theme.scrollbar || {};

                    // Apply color variables
                    root.style.setProperty('--color-primary', colors.primary || '#6366f1');
                    root.style.setProperty('--color-secondary', colors.secondary || '#ec4899');
                    root.style.setProperty('--color-accent', colors.accent || '#8b5cf6');
                    root.style.setProperty('--color-background', colors.background || '#020617');
                    root.style.setProperty('--color-surface', colors.surface || '#1e293b');
                    root.style.setProperty('--color-surface-alt', colors.surfaceAlt || '#0f172a');
                    root.style.setProperty('--color-border', colors.border || '#374151');
                    root.style.setProperty('--color-text', colors.text || '#f3f4f6');
                    root.style.setProperty('--color-text-muted', colors.textMuted || '#9ca3af');
                    root.style.setProperty('--color-text-dim', colors.textDim || '#6b7280');
                    root.style.setProperty('--color-success', colors.success || '#22c55e');
                    root.style.setProperty('--color-warning', colors.warning || '#f59e0b');
                    root.style.setProperty('--color-error', colors.error || '#ef4444');
                    root.style.setProperty('--color-info', colors.info || '#3b82f6');

                    // Apply button variables
                    if (buttons.primary) {
                        root.style.setProperty('--btn-primary-bg', buttons.primary.background || '#6366f1');
                        root.style.setProperty('--btn-primary-text', buttons.primary.text || '#ffffff');
                        root.style.setProperty('--btn-primary-hover', buttons.primary.hoverBackground || '#4f46e5');
                    }
                    if (buttons.secondary) {
                        root.style.setProperty('--btn-secondary-bg', buttons.secondary.background || 'transparent');
                        root.style.setProperty('--btn-secondary-text', buttons.secondary.text || '#9ca3af');
                        root.style.setProperty('--btn-secondary-border', buttons.secondary.border || '#374151');
                        root.style.setProperty('--btn-secondary-hover-bg', buttons.secondary.hoverBackground || '#1f2937');
                    }

                    // Apply sidebar variables
                    root.style.setProperty('--sidebar-bg', sidebar.background || '#1e293b');
                    root.style.setProperty('--sidebar-item-active-bg', sidebar.itemBackgroundActive || 'rgba(99, 102, 241, 0.2)');
                    root.style.setProperty('--sidebar-item-text', sidebar.itemText || '#9ca3af');
                    root.style.setProperty('--sidebar-item-text-active', sidebar.itemTextActive || '#6366f1');

                    // Apply card variables
                    root.style.setProperty('--card-bg', cards.background || '#1e293b');
                    root.style.setProperty('--card-border', cards.border || 'rgba(55, 65, 81, 0.5)');
                    root.style.setProperty('--card-hover-border', cards.hoverBorder || 'rgba(99, 102, 241, 0.5)');

                    // Apply input variables
                    root.style.setProperty('--input-bg', inputs.background || '#0f172a');
                    root.style.setProperty('--input-border', inputs.border || '#374151');
                    root.style.setProperty('--input-focus-border', inputs.focusBorder || '#6366f1');

                    // Apply scrollbar variables
                    root.style.setProperty('--scrollbar-track', scrollbar.track || '#1e293b');
                    root.style.setProperty('--scrollbar-thumb', scrollbar.thumb || '#475569');
                    root.style.setProperty('--scrollbar-thumb-hover', scrollbar.thumbHover || '#64748b');

                    // Apply fonts
                    if (theme.fonts?.primary) {
                        root.style.setProperty('--font-primary', theme.fonts.primary);
                    }
                },

                getThemeAssetUrl(filename) {
                    if (!filename || !this.activeThemeData?._path) return '';
                    const themePath = this.activeThemeData._path.replace(/\\/g, '/');
                    return `/${themePath}/${filename}`;
                },

                getThemePreviewUrl(theme) {
                    if (!theme.meta.preview || !theme.path) return '';
                    const themePath = theme.path.replace(/\\/g, '/');
                    return `/${themePath}/${theme.meta.preview}`;
                },

                getThemeGradient(theme) {
                    const colors = theme.colors || {};
                    const primary = colors.primary || '#6366f1';
                    const secondary = colors.secondary || '#ec4899';
                    const bg = colors.background || '#020617';
                    return `linear-gradient(135deg, ${bg} 0%, ${primary}33 50%, ${secondary}33 100%)`;
                },

                getThemeColors(theme) {
                    const colors = theme.colors || {};
                    return [
                        colors.primary || '#6366f1',
                        colors.secondary || '#ec4899',
                        colors.accent || '#8b5cf6',
                        colors.background || '#020617',
                        colors.surface || '#1e293b'
                    ];
                },

                // GPU/Renderer methods
                async fetchAppSettings() {
                    try {
                        const res = await fetch('/api/settings/current');
                        const data = await res.json();
                        this.appSettings = { ...this.appSettings, ...data };
                    } catch (e) {
                        console.error("Failed to load app settings", e);
                    }
                },

                async fetchGpuInfo() {
                    try {
                        const res = await fetch('/api/settings/gpu/info');
                        this.gpuInfo = await res.json();
                    } catch (e) {
                        console.error("Failed to load GPU info", e);
                    }
                },

                async selectRenderer(rendererId) {
                    if (rendererId === this.appSettings.renderer) return;

                    this.playClickSound();
                    const previousRenderer = this.appSettings.renderer;
                    this.appSettings.renderer = rendererId;

                    try {
                        const res = await fetch('/api/settings/update', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.appSettings)
                        });
                        const result = await res.json();

                        if (result.success) {
                            this.pendingRendererChange = true;
                        }
                    } catch (e) {
                        console.error("Failed to update renderer setting", e);
                        // Revert on error
                        this.appSettings.renderer = previousRenderer;
                    }
                },

                getRendererDisplayName(rendererId) {
                    const names = {
                        'edgechromium': 'Edge Chromium (DirectX)',
                        'cef': 'CEF (OpenGL)',
                        'mshtml': 'Legacy (Software)'
                    };
                    return names[rendererId] || rendererId;
                },

                getRendererApi(rendererId) {
                    const apis = {
                        'edgechromium': 'Direct3D 11/12 via ANGLE',
                        'cef': 'OpenGL 3.3+',
                        'mshtml': 'Software (GDI)'
                    };
                    return apis[rendererId] || 'Unknown';
                },

                async selectGpu(gpuId) {
                    if (gpuId === this.appSettings.selected_gpu) return;

                    this.playClickSound();
                    const previousGpu = this.appSettings.selected_gpu;
                    this.appSettings.selected_gpu = gpuId;

                    try {
                        const res = await fetch(`/api/settings/gpu/select/${gpuId}`, {
                            method: 'POST'
                        });
                        const result = await res.json();

                        if (result.success) {
                            this.pendingRendererChange = true;
                        }
                    } catch (e) {
                        console.error("Failed to select GPU", e);
                        this.appSettings.selected_gpu = previousGpu;
                    }
                },

                async saveAppSettings() {
                    try {
                        await fetch('/api/settings/update', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.appSettings)
                        });
                    } catch (e) {
                        console.error("Failed to save app settings", e);
                    }
                },

                getGpuGradient(gpu) {
                    if (!gpu) return 'linear-gradient(135deg, #6B7280, #374151)';

                    const name = (gpu.name || '').toLowerCase();
                    const vendor = (gpu.vendor || '').toLowerCase();

                    // NVIDIA - Green
                    if (name.includes('nvidia') || name.includes('geforce') ||
                        name.includes('gtx') || name.includes('rtx') ||
                        vendor.includes('nvidia')) {
                        return 'linear-gradient(135deg, #76B900, #4B7600)';
                    }

                    // AMD - Red
                    if (name.includes('radeon') || name.includes('amd') ||
                        name.includes('rx ') || vendor.includes('amd') ||
                        vendor.includes('advanced micro')) {
                        return 'linear-gradient(135deg, #ED1C24, #9B1218)';
                    }

                    // Intel - Blue
                    if (name.includes('intel') || name.includes('iris') ||
                        name.includes('uhd') || vendor.includes('intel')) {
                        return 'linear-gradient(135deg, #0071C5, #004B8D)';
                    }

                    // Default - Gray
                    return 'linear-gradient(135deg, #6B7280, #374151)';
                },

                playGame(id) {
                    this.playClickSound();
                    window.location.href = `/game/${id}`;
                }
            }
        }
    </script>
</body>

</html>